create table if not exists rooms (
  id integer primary key AUTOINCREMENT,
  name text,
  code text,
  description text,
  exits text,
  zone text,
  mapinfo text,
  blockzone text
);
create unique index idx_rooms on rooms (code);

create table if not exists paths (
  startid integer,
  endid integer,
  path text,
  endcode text,
  weight integer default 1,
  enabled integer default 1,
  category integer default 1,
  mapchange integer default 0,
  blockers text
);
create index if not exists idx_paths on paths (startid, endid);

create table if not exists path_category (
  id integer primary key AUTOINCREMENT ,
  name text,
  description text
);
create index idx_path_category_name on path_category (name);
insert into path_category (id, name, description) values
  (1, 'normal', '单个命令'),
  (2, 'multiple', '多个命令，使用分号隔开'),
  (3, 'busy', '单个命令，将导致busy状态，可能需要多次重复执行'),
  (4, 'boat', '乘船命令'),
  (5, 'pause', '行走暂停'),
  (6, 'block', '被阻挡，有npc挡路需要清除');

create table if not exists pinyin2chr (
  pinyin text primary key,
  chr text
);
create table if not exists chr2pinyin (
  chr text primary key,
  chrcode integer,
  pinyin text
);
create index if not exists idx_chr2pinyin on chr2pinyin (chrcode);

create table if not exists zones (
  id integer primary key AUTOINCREMENT,
  code text unique,
  name text,
  centercode text
);

insert into zones (code, name, centercode)
values
  ('yangzhou', '扬州', 'yangzhouzhongyangguangchang'),
  ('zhongyuan', '中原', 'zhongyuanxuchang'),
  ('xiaoshancun', '小山村', 'xiaoshancundaguchang'),
  ('huashan', '华山', 'huashanshufang'),
  ('qufu', '曲阜', 'qufukongmiao'),
  ('xinyang', '信阳', 'xinyangxiaoguangchang'),
  ('quanzhen', '全真', 'quanzhenchongxuantai'),
  ('changjiangbei', '长江北岸', 'changjiangbeichangjiangdukou3'),
  ('huanghenan', '黄河南岸', 'huanghenanmengjindu'),
  ('luoyang', '洛阳', 'luoyangzhongxingguangchang'),
  ('changan', '长安', 'changanzhuquedajie'),
  ('chengdu', '成都', 'chengduzongdufumenqian'),
  ('tianlongsi', '天龙寺', 'tianlongsisanyuangong'),
  ('dali', '大理', 'dalizhongxinguangchang'),
  ('yueyang', '岳阳', 'yueyangchengzhongxin'),
  ('jiangzhou', '江州', 'jiangzhouzhongyangguangchang'),
  ('nanchang', '南昌', 'nanchangchengzhongxin'),
  ('quanzhou', '泉州', 'quanzhouchengzhongxin'),
  ('fuzhou', '福州', 'fuzhouchengzhongxin'),
  ('jiaxing', '嘉兴', 'jiaxingjiaxingcheng'),
  ('yashan', '牙山', 'yashanyashanwanzhongxin'),
  ('mingzhou', '明州', 'mingzhoumingzhoufu'),
  ('suzhou', '苏州', 'suzhoubaodaiqiao'),
  ('zhenjiang', '镇江', 'zhenjiangguangchang'),
  ('dufu', '都府', 'dufudating'),
  ('jiankang', '建康府', 'jiankangzhongcheng'),
  ('linan', '临安府', 'linanfudalisi'),
  ('changjiangnan', '长江南岸', 'changjiangnanyanziji'),
  ('lingzhou', '灵州', 'lingzhouchengzhongxin'),
  ('dalunsi', '大轮寺', 'dalunsizhudubadian'),
  ('huizuxiaozhen', '回族小镇', 'huizuxiaozhenxiaozhen'),
  ('qilincun', '麒麟村', 'qilincunxiaoguangchang'),
  ('kunming', '昆明', 'kunmingzhongxinguangchang'),
  ('pingxiwangfu', '平西王府', 'pingxiwangfupingxiwangfudamen'),
  ('guiyunzhuang', '归云庄', 'guiyunzhuangguiyunzhuangdamen'),
  ('taishan', '泰山', 'taishannantianmen'),
  ('huanghebei', '黄河北岸', 'huanghebeifenglingdu'),
  ('jinyang', '晋阳', 'jinyangchaoximenneijie'),
  ('zhangjiakou', '张家口', 'zhangjiakouguangchang'),
  ('lingxiao', '凌霄城', 'lingxiaobingjieguangchang'),
  ('sichouzhilu', '丝绸之路', 'sichouzhilusichouzhilu'),
  ('taoyuan', '桃源', 'taoyuantaoyuanxianjing'),
  ('xiangyang', '襄阳', 'xiangyangchengzhongxin'),
  ('beijing', '北京', 'beijingyonganmen'),
  ('wudang', '武当', 'wudangwudangguangchang'),
  ('lanzhou', '兰州', 'lanzhoufuqianguangchang'),
  ('huangzhong', '湟中', 'huangzhonghuangzhongzhongxin'),
  ('xingxiu', '星宿', 'xingxiujuyan'),
  ('mingjiao', '明教', 'mingjiaoshanmen'),
  ('gumu', '古墓', 'gumuduanlongshi'),
  ('shaolin', '少林', 'shaolinguangchang'),
  ('lingjiu', '灵鹫', 'lingjiubaizhangjian'),
  ('emei', '峨眉', 'emeishanmen'),
  ('xihu', '西湖', 'xihuhangzhoufenduodamen'),
  ('yuewangmu', '岳王墓', 'yuewangmumuqianxiaodao'),
  ('murong', '姑苏慕容', 'muronghubian'),
  ('riyue', '日月神教', 'riyuexiaoshancun'),
  ('taohuadao', '桃花岛', 'taohaodaodating'),
  ('kangqinwangfu', '康亲王府', 'kangqinwangfudating'),
  ('emeihoushan', '峨眉后山', 'emeihoushanshandao'),
  ('wuliangshan', '无量山', 'wuliangshanhoushan'),
  ('tidufu', '杭州提督府', 'tidufuzhengting'),
  ('tiantan', '天坛', 'tiantanxitianmen'),
  ('shenlongdao', '神龙岛', 'shenlongdaofengding'),
  ('shashoubang', '杀手帮', 'shashoubangguangchang'),
  ('gaibang', '丐帮', 'gaibangshudongneibu')
  -- ('miaoling', '苗岭', 'miaolingbianyuan')
;

create table if not exists zone_connectivity (
  startcode text,
  endcode text,
  weight integer,
  busy integer not null default 0,
  boat integer not null default 0,
  primary key (startcode, endcode)
);

insert into zone_connectivity (startcode, endcode, weight)
values
  ('huashan', 'xiaoshancun', 13),    -- use 13 or 20?
  ('xiaoshancun', 'huashan', 13),
  ('xiaoshancun', 'zhongyuan', 8),
  ('zhongyuan', 'xiaoshancun', 8),
  ('zhongyuan', 'yangzhou', 10),
  ('yangzhou', 'zhongyuan', 10),
  ('yangzhou', 'qufu', 10),
  ('qufu', 'yangzhou', 10),
  ('qufu', 'zhongyuan', 12),
  ('zhongyuan', 'qufu', 12),
  ('xinyang', 'yangzhou', 10),
  ('yangzhou', 'xinyang', 10),
  ('xinyang', 'zhongyuan', 6),
  ('zhongyuan', 'xinyang', 6),
  ('xiaoshancun', 'quanzhen', 13),
  ('quanzhen', 'xiaoshancun', 13),
  ('changjiangbeian', 'yangzhou', 12),
  ('yangzhou', 'changjiangbeian', 12),
  ('changjiangbei', 'xinyang', 15),
  ('xinyang', 'changjiangbei', 15),
  ('huanghenan', 'qufu', 11),
  ('qufu', 'huanghenan', 11),
  ('luoyang', 'huanghenan', 8),
  ('huanghenan', 'luoyang', 8),
  ('luoyang', 'zhongyuan', 9),
  ('zhongyuan', 'luoyang', 9),
  ('huashan', 'changan', 15),  -- use 15 or 22?
  ('changan', 'huashan', 15),
  ('huanghenan', 'changan', 18),
  ('changan', 'huanghenan', 18),
  ('luoyang', 'changan', 18),
  ('changan', 'luoyang', 18),
  ('changan', 'chengdu', 40),
  ('chengdu', 'changan', 40),
  ('tianlongsi', 'chengdu', 25),
  ('chengdu', 'tianlongsi', 25),
  ('tianlongsi', 'dali', 11),
  ('dali', 'tianlongsi', 11),
  ('chengdu', 'yueyang', 43),
  ('yueyang', 'chengdu', 43),
  ('yueyang', 'jiangzhou', 10),
  ('jiangzhou', 'yueyang', 10),
  ('jiangzhou', 'nanchang', 10),
  ('nanchang', 'jiangzhou', 10),
  ('nanchang', 'quanzhou', 9),
  ('quanzhou', 'nanchang', 9),
  ('quanzhou', 'fuzhou', 9),
  ('fuzhou', 'quanzhou', 9),
  ('quanzhou', 'jiaxing', 5),
  ('jiaxing', 'quanzhou', 5),
  ('jiaxing', 'yashan', 13),
  ('yashan', 'jiaxing', 13),
  ('yashan', 'mingzhou', 4),
  ('mingzhou', 'yashan', 4),
  ('mingzhou', 'jiaxing', 7),
  ('jiaxing', 'mingzhou', 7),
  ('jiaxing', 'suzhou', 5),
  ('suzhou', 'jiaxing', 5),
  ('suzhou', 'zhenjiang', 17),
  ('zhenjiang', 'suzhou', 17),
  ('dufu', 'jiankang', 8),
  ('jiankang', 'dufu', 8),
  ('jiankang', 'suzhou', 21),
  ('suzhou', 'jiankang', 21),
  ('jiankang', 'jiaxing', 22),
  ('jiaxing', 'jiankang', 22),
  ('jiankang', 'zhenjiang', 16),
  ('zhenjiang', 'jiankang', 16),
  ('jiankang', 'jiangzhou', 14),
  ('jiangzhou', 'jiankang', 14),
  ('jiankang', 'linan', 19),
  ('linan', 'jiankang', 19),
  ('linan', 'quanzhou', 14),
  ('quanzhou', 'linan', 14),
  ('yueyang', 'changjiangnan', 19),
  ('changjiangnan', 'yueyang', 19),
  ('jiangzhou', 'changjiangnan', 12),
  ('changjiangnan', 'jiangzhou', 12),
  ('jiankang', 'changjiangnan', 12),
  ('changjiangnan', 'jiankang', 12),
  ('zhenjiang', 'changjiangnan', 11),
  ('changjiangnan', 'zhenjiang', 11),
  ('suzhou', 'changjiangnan', 22),
  ('changjiangnan', 'suzhou', 22),
  ('changjiangbei', 'changjiangnan', 1),
  ('changjiangnan', 'changjiangbei', 1),
  ('huanghenan', 'lingzhou', 17),
  ('lingzhou', 'huanghenan', 17),
  ('lingzhou', 'dalunsi', 16),  -- use zanpu as connect-point
  ('dalunsi', 'lingzhou', 16),
  ('dalunsi', 'chengdu', 27),  -- use zanpu as connect-point
  ('chengdu', 'dalunsi', 27),
  ('huanghenan', 'huizuxiaozhen', 21),
  ('huizuxiaozhen', 'huanghenan', 21),
  ('huizuxiaozhen', 'changan', 17),
  ('changan', 'huizuxiaozhen', 17),
  ('luoyang', 'qilincun', 13),
  ('qilincun', 'luoyang', 13),
  ('dali', 'kunming', 11),
  ('kunming', 'dali', 11),
  ('kunming', 'pingxiwangfu', 7),
  ('pingxiwangfu', 'kunming', 7),
  ('suzhou', 'guiyunzhuang', 27),
  ('guiyunzhuang', 'suzhou', 27),
  ('qufu', 'taishan', 21),
  ('taishan', 'qufu', 21),
  ('huanghenan', 'huanghebei', 1),
  ('huanghebei', 'huanghenan', 1),
  ('huanghebei', 'jinyang', 12),
  ('jinyang', 'huanghebei', 12),
  ('jinyang', 'zhangjiakou', 16),
  ('zhangjiakou', 'jinyang', 16),
  ('dalunsi', 'lingxiao', 16),
  ('lingxiao', 'dalunsi', 16),
  ('huanghebei', 'sichouzhilu', 20),
  ('sichouzhilu', 'huanghebei', 20),
  ('yueyang', 'taoyuan', 8),
  ('taoyuan', 'yueyang', 8),
  ('xinyang', 'xiangyang', 9),
  ('xiangyang', 'xinyang', 9),
  ('xiangyang', 'changjiangbei', 31),
  ('changjiangbei', 'xiangyang', 31),
  ('huanghebei', 'beijing', 9),
  ('beijing', 'huanghebei', 9),
  ('beijing', 'jinyang', 6),
  ('jinyang', 'beijing', 6),
  ('zhangjiakou', 'beijing', 7),
  ('beijing', 'zhangjiakou', 7),
  ('xiaoshancun', 'wudang', 13),
  ('wudang', 'xiaoshancun', 13),
  ('wudang', 'xiangyang', 21),
  ('xiangyang', 'wudang', 21),
  ('huanghebei', 'lanzhou', 19),
  ('lanzhou', 'huanghebei', 19),
  ('lanzhou', 'huangzhong', 9),
  ('huangzhong', 'lanzhou', 9),
  ('huangzhong', 'xingxiu', 4),
  ('xingxiu', 'huangzhong', 4),
  ('huanghebei', 'mingjiao', 33),
  ('mingjiao', 'huanghebei', 33),
  ('quanzhen', 'gumu', 17),
  ('gumu', 'quanzhen', 17),
  ('gumu', 'changan', 12),
  ('changan', 'gumu', 12),
  ('zhongyuan', 'shaolin', 6),
  ('shaolin', 'zhongyuan', 6),
  ('shaolin', 'gumu', 10),
  ('gumu', 'shaolin', 10),
  ('lingzhou', 'lingjiu', 8),
  ('lingjiu', 'lingzhou', 8),
  ('lingjiu', 'huizuxiaozhen', 5),
  ('huizuxiaozhen', 'lingjiu', 5),
  ('chengdu', 'emei', 13),
  ('emei', 'chengdu', 13),
  ('linan', 'xihu', 7),
  ('xihu', 'linan', 7),
  ('quanzhou', 'yuewangmu', 6),
  ('yuewangmu', 'quanzhou', 6),
  ('suzhou', 'murong', 7),
  ('murong', 'suzhou', 7),
  ('jinyang', 'riyue', 8),
  ('riyue', 'jinyang', 8),
  ('mingzhou', 'taohuadao', 14),
  ('taohuadao', 'mingzhou', 14),
  ('beijing', 'kangqinwangfu', 14),
  ('kangqinwangfu', 'beijing', 14),
  ('emeihoushan', 'emei', 6),
  ('emei', 'emeihoushan', 6),
  ('tianlongsi', 'wuliangshan', 6),
  ('wuliangshan', 'tianlongsi', 6),
  ('linan', 'tidufu', 13),
  ('tidufu', 'linan', 13),
  ('beijing', 'tiantan', 4),
  ('tiantan', 'beijing', 4),
  ('beijing', 'shenlongdao', 35),
  ('shenlongdao', 'beijing', 35),
  ('xinyang', 'shashoubang', 6),
  ('shashoubang', 'xinyang', 6),
  ('shashoubang', 'yangzhou', 20),
  ('yangzhou', 'shashoubang', 20),
  ('yangzhou', 'gaibang', 1),
  ('gaibang', 'yangzhou', 1),
  ('gaibang', 'xiaoshancun', 5),
  ('gaibang', 'shaolin', 16),
  ('shaolin', 'gaibang', 16),
  ('gaibang', 'huizuxiaozhen', 6),
  ('gaibang', 'wudang', 8),
  ('gaibang', 'huanghenan', 10),
  ('huanghenan', 'gaibang', 10),
  ('gaibang', 'lingxiao', 16),
  ('lingxiao', 'gaibang', 16),
  ('nanchang', 'miaoling', 6),
  ('miaoling', 'nanchang', 6),
  ('kunming', 'miaoling', 6),
  ('miaoling', 'yueyang', 6),
  ('yueyang', 'miaoling', 6)
;

update zone_connectivity set boat = 1
where (startcode = 'changjiangnan' and endcode = 'changjiangbei')
or (startcode = 'changjiangbei' and endcode = 'changjiangnan')
or (startcode = 'huanghebei' and endcode = 'huanghenan')
or (startcode = 'huanghenan' and endcode = 'huanghebei')
;

-- npc table
create table if not exists npcs (
  id text,
  name text,
  roomid integer,
  zone text,
  unique (id, roomid)
);
create index if not exists idx_npcs_name on npcs (name);
create index if not exists idx_npcs_zone_name on npcs (zone, name);


